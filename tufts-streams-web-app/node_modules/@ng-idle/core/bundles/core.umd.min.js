!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs/add/operator/throttleTime"),require("rxjs/add/observable/fromEvent"),require("rxjs/Observable"),require("@angular/core")):"function"==typeof define&&define.amd?define(["exports","rxjs/add/operator/throttleTime","rxjs/add/observable/fromEvent","rxjs/Observable","@angular/core"],e):e((t.ngidle=t.ngidle||{},t.ngidle.core=t.ngidle.core||{}),t.rxjs_add_operator_throttleTime,t.rxjs_add_observable_fromEvent,t.rxjs_Observable,t.ng.core)}(this,function(t,e,n,i,r){"use strict";var o=function(){function t(t,e,n){void 0===n&&(n=!1),this.source=t,this.innerArgs=e,this.force=n}return t}(),s=function(){function t(t,e){this.attachFn=t,this.detachFn=e,this.isAttached=!1,this.onInterrupt=new r.EventEmitter}return t.prototype.attach=function(){!this.isAttached&&this.attachFn&&this.attachFn(this),this.isAttached=!0},t.prototype.detach=function(){this.isAttached&&this.detachFn&&this.detachFn(this),this.isAttached=!1},t}(),u=function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},a=function(t){function e(e,n,r){void 0===r&&(r=500);var s=t.call(this,null,null)||this;s.target=e,s.events=n,s.throttleDelay=r,s.eventSrc=new Array,s.eventSubscription=new Array;var u=s;n.split(" ").forEach(function(t){var n=i.Observable.fromEvent(e,t);u.throttleDelay>0&&(n=n.throttleTime(u.throttleDelay)),u.eventSrc.push(n)});var a=function(t){if(!u.filterEvent(t)){var e=new o(this,t);u.onInterrupt.emit(e)}};return s.attachFn=function(){s.eventSrc.forEach(function(t){u.eventSubscription.push(t.subscribe(a))})},s.detachFn=function(){s.eventSubscription.forEach(function(t){t.unsubscribe()}),s.eventSubscription.length=0},s}return u(e,t),e.prototype.filterEvent=function(t){return!1},e}(s),l=function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},p=function(t){function e(e,n){return void 0===n&&(n=500),t.call(this,document.documentElement,e,n)||this}return l(e,t),e.prototype.filterEvent=function(t){return!("mousemove"!==t.type||!(t.originalEvent&&0===t.originalEvent.movementX&&0===t.originalEvent.movementY||void 0!==t.movementX&&!t.movementX)&&t.movementY)},e}(a),c=function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},h=function(t){function e(e,n){return void 0===n&&(n=500),t.call(this,window,e,n)||this}return c(e,t),e}(a),d=function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},f=function(t){function e(e){return void 0===e&&(e=500),t.call(this,"storage",e)||this}return d(e,t),e.prototype.filterEvent=function(t){return!(t.key.indexOf("ng2Idle.")>=0&&t.key.indexOf(".expiry")>=0)},e}(h),v=function(){function t(){this.idValue=new Date,this.idlingValue=!1}return t.prototype.id=function(t){if(void 0!==t){if(!t)throw new Error("A value must be specified for the ID.");this.idValue=t}return this.idValue},t.prototype.idling=function(t){return void 0!==t&&(this.idlingValue=t),this.idlingValue},t.prototype.now=function(){return new Date},t.prototype.isExpired=function(){var t=this.last();return null!=t&&t<=this.now()},t}(),g=function(){function t(t){this.source=t}return t.prototype.subscribe=function(t){this.sub=this.source.onInterrupt.subscribe(t)},t.prototype.unsubscribe=function(){this.sub.unsubscribe(),this.sub=null},t.prototype.resume=function(){this.source.attach()},t.prototype.pause=function(){this.source.detach()},t}(),y=function(){function t(){}return t}(),m=function(){function t(){this.storageMap={}}return Object.defineProperty(t.prototype,"length",{get:function(){return Object.keys(this.storageMap).length},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.storageMap={}},t.prototype.getItem=function(t){return void 0!==this.storageMap[t]?this.storageMap[t]:null},t.prototype.key=function(t){return Object.keys(this.storageMap)[t]||null},t.prototype.removeItem=function(t){this.storageMap[t]=void 0},t.prototype.setItem=function(t,e){this.storageMap[t]=e},t}(),I=function(){function t(){this.storage=this.getStorage()}return t.prototype.getStorage=function(){try{var t=localStorage;return t.setItem("ng2IdleStorage",""),t.removeItem("ng2IdleStorage"),t}catch(t){return new m}},t.prototype.getItem=function(t){return this.storage.getItem("ng2Idle."+t)},t.prototype.removeItem=function(t){this.storage.removeItem("ng2Idle."+t)},t.prototype.setItem=function(t,e){this.storage.setItem("ng2Idle."+t,e)},t.prototype._wrapped=function(){return this.storage},t}();I.decorators=[{type:r.Injectable}],I.ctorParameters=function(){return[]};var b=function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},w=function(t){function e(e){var n=t.call(this)||this;return n.localStorage=e,n.idleName="main",n}return b(e,t),e.prototype.last=function(t){return void 0!==t&&this.setExpiry(t),this.getExpiry()},e.prototype.idling=function(t){return void 0!==t&&this.setIdling(t),this.getIdling()},e.prototype.getIdleName=function(){return this.idleName},e.prototype.setIdleName=function(t){t&&(this.idleName=t)},e.prototype.getExpiry=function(){var t=this.localStorage.getItem(this.idleName+".expiry");return t?new Date(parseInt(t,10)):null},e.prototype.setExpiry=function(t){t?this.localStorage.setItem(this.idleName+".expiry",t.getTime().toString()):this.localStorage.removeItem(this.idleName+".expiry")},e.prototype.getIdling=function(){var t=this.localStorage.getItem(this.idleName+".idling");return!!t&&"true"===t},e.prototype.setIdling=function(t){t?this.localStorage.setItem(this.idleName+".idling",t.toString()):this.localStorage.setItem(this.idleName+".idling","false")},e}(v);w.decorators=[{type:r.Injectable}],w.ctorParameters=function(){return[{type:I}]},function(t){t[t.disabled=0]="disabled",t[t.idle=1]="idle",t[t.notIdle=2]="notIdle"}(t.AutoResume||(t.AutoResume={}));var E=function(){function e(e,n){this.expiry=e,this.idle=1200,this.timeoutVal=30,this.autoResume=t.AutoResume.idle,this.interrupts=new Array,this.running=!1,this.keepaliveEnabled=!1,this.onIdleStart=new r.EventEmitter,this.onIdleEnd=new r.EventEmitter,this.onTimeoutWarning=new r.EventEmitter,this.onTimeout=new r.EventEmitter,this.onInterrupt=new r.EventEmitter,n&&(this.keepaliveSvc=n,this.keepaliveEnabled=!0),this.setIdling(!1)}return e.prototype.setIdleName=function(t){if(!(this.expiry instanceof w))throw new Error("Cannot set expiry key name because no LocalStorageExpiry has been provided.");this.expiry.setIdleName(t)},e.prototype.getKeepaliveEnabled=function(){return this.keepaliveEnabled},e.prototype.setKeepaliveEnabled=function(t){if(!this.keepaliveSvc)throw new Error("Cannot enable keepalive integration because no KeepaliveSvc has been provided.");return this.keepaliveEnabled=t},e.prototype.getTimeout=function(){return this.timeoutVal},e.prototype.setTimeout=function(t){if(t===!1)this.timeoutVal=0;else{if(!("number"==typeof t&&t>=0))throw new Error("'seconds' can only be 'false' or a positive number.");this.timeoutVal=t}return this.timeoutVal},e.prototype.getIdle=function(){return this.idle},e.prototype.setIdle=function(t){if(t<=0)throw new Error("'seconds' must be greater zero");return this.idle=t},e.prototype.getAutoResume=function(){return this.autoResume},e.prototype.setAutoResume=function(t){return this.autoResume=t},e.prototype.setInterrupts=function(t){this.clearInterrupts();for(var e=this,n=0,i=t;n<i.length;n++){var r=i[n],o=new g(r);o.subscribe(function(t){e.interrupt(t.force,t.innerArgs)}),this.interrupts.push(o)}return this.interrupts},e.prototype.getInterrupts=function(){return this.interrupts},e.prototype.clearInterrupts=function(){for(var t=0,e=this.interrupts;t<e.length;t++){var n=e[t];n.pause(),n.unsubscribe()}this.interrupts.length=0},e.prototype.isRunning=function(){return this.running},e.prototype.isIdling=function(){return this.idling},e.prototype.watch=function(t){var e=this;this.safeClearInterval("idleHandle"),this.safeClearInterval("timeoutHandle");var n=this.timeoutVal?this.timeoutVal:0;if(!t){var i=new Date(this.expiry.now().getTime()+1e3*(this.idle+n));this.expiry.last(i)}this.idling&&this.toggleState(),this.running||(this.startKeepalive(),this.toggleInterrupts(!0)),this.running=!0;var r=function(){var t=e.getExpiryDiff(n);t>0?(e.safeClearInterval("idleHandle"),e.idleHandle=setInterval(r,t)):e.toggleState()};this.idleHandle=setInterval(r,1e3*this.idle)},e.prototype.stop=function(){this.stopKeepalive(),this.toggleInterrupts(!1),this.safeClearInterval("idleHandle"),this.safeClearInterval("timeoutHandle"),this.setIdling(!1),this.running=!1,this.expiry.last(null)},e.prototype.timeout=function(){this.stopKeepalive(),this.toggleInterrupts(!1),this.safeClearInterval("idleHandle"),this.safeClearInterval("timeoutHandle"),this.setIdling(!0),this.running=!1,this.countdown=0,this.onTimeout.emit(null)},e.prototype.interrupt=function(e,n){if(this.running){if(this.timeoutVal&&this.expiry.isExpired())return void this.timeout();this.onInterrupt.emit(n),(e===!0||this.autoResume===t.AutoResume.idle||this.autoResume===t.AutoResume.notIdle&&!this.expiry.idling())&&this.watch(e)}},e.prototype.setIdling=function(t){this.idling=t,this.expiry.idling(t)},e.prototype.toggleState=function(){var t=this;this.setIdling(!this.idling),this.idling?(this.onIdleStart.emit(null),this.stopKeepalive(),this.timeoutVal>0&&(this.countdown=this.timeoutVal,this.doCountdown(),this.timeoutHandle=setInterval(function(){t.doCountdown()},1e3))):(this.toggleInterrupts(!0),this.onIdleEnd.emit(null),this.startKeepalive()),this.safeClearInterval("idleHandle")},e.prototype.toggleInterrupts=function(t){for(var e=0,n=this.interrupts;e<n.length;e++){var i=n[e];t?i.resume():i.pause()}},e.prototype.getExpiryDiff=function(t){var e=this.expiry.now();return(this.expiry.last()||e).getTime()-e.getTime()-1e3*t},e.prototype.doCountdown=function(){var t=this.timeoutVal?this.timeoutVal:0;if(this.getExpiryDiff(t)>0)return this.safeClearInterval("timeoutHandle"),void this.interrupt(!0);if(this.idling){if(this.countdown<=0)return void this.timeout();this.onTimeoutWarning.emit(this.countdown),this.countdown--}},e.prototype.safeClearInterval=function(t){this[t]&&(clearInterval(this[t]),this[t]=null)},e.prototype.startKeepalive=function(){this.keepaliveSvc&&this.keepaliveEnabled&&(this.running&&this.keepaliveSvc.ping(),this.keepaliveSvc.start())},e.prototype.stopKeepalive=function(){this.keepaliveSvc&&this.keepaliveEnabled&&this.keepaliveSvc.stop()},e.prototype.ngOnDestroy=function(){this.stop(),this.clearInterrupts()},e}();E.decorators=[{type:r.Injectable}],E.ctorParameters=function(){return[{type:v},{type:y,decorators:[{type:r.Optional}]}]};var S=function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},x=function(t){function e(){var e=t.call(this)||this;return e.lastValue=null,e}return S(e,t),e.prototype.last=function(t){return void 0!==t&&(this.lastValue=t),this.lastValue},e}(v),O=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[w,{provide:v,useExisting:w},E]}},t}();O.decorators=[{type:r.NgModule,args:[{providers:[I]}]}],O.ctorParameters=function(){return[]};var j=[new p("mousemove keydown DOMMouseScroll mousewheel mousedown touchstart touchmove scroll"),new f];t.DEFAULT_INTERRUPTSOURCES=j,t.NgIdleModule=O,t.Idle=E,t.InterruptArgs=o,t.InterruptSource=s,t.EventTargetInterruptSource=a,t.DocumentInterruptSource=p,t.WindowInterruptSource=h,t.StorageInterruptSource=f,t.KeepaliveSvc=y,t.IdleExpiry=v,t.SimpleExpiry=x,t.LocalStorage=I,t.LocalStorageExpiry=w,Object.defineProperty(t,"__esModule",{value:!0})});
